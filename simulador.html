<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador de crédito | Booh Finance</title>

  <!-- ESTILOS GLOBALES -->
  <link rel="stylesheet" href="style.css?v=7">
  <script src="menu.js?v=7" defer></script>
</head>

<body>
  <!-- ===== HEADER (idéntico al index) ===== -->
  <header>
    <nav class="navbar">
      <a href="index.html">
        <img src="img/logo-booh.png" alt="Booh Finance" class="logo">
      </a>

      <ul>
        <li><a href="index.html#home">Inicio</a></li>
        <li><a href="index.html#how">Cómo funciona</a></li>
        <li><a href="index.html#benefits">Ventajas</a></li>
        <li><a href="index.html#ai">IA Pricing</a></li>
        <li><a href="simulador.html">Simulador</a></li>
        <li><a href="index.html#contact">Contacto</a></li>
      </ul>

      <button class="menu-toggle" aria-label="Abrir menú">
        <span></span><span></span><span></span>
      </button>
    </nav>
  </header>

  <!-- ===== HERO DEL SIMULADOR ===== -->
  <section id="hero-simulator" class="hero-simulator">
    <div class="hero-content">
      <h1>Simula tu crédito en segundos</h1>
      <p>Descubre cuánto puedes financiar con Booh Finance y cómo se adaptan tus pagos a tus ventas.</p>
      <a href="#simulator" class="cta">Comenzar simulación</a>
    </div>
  </section>

  <!-- ===== CONTENIDO DEL SIMULADOR ===== -->
  <main>
    <section id="simulator" class="section fade-in">
      <h2>Calcula tu crédito Booh Finance</h2>

      <div class="simu">
        <form class="simu-form" id="simuForm">
          <div class="field">
            <label>Ventas totales del último mes (€)</label>
            <input id="monthlySales" type="number" min="0" step="100" value="10000" required>
            <div class="hint">Usamos tus ventas para calcular la comisión, crédito máximo y devolución estimada.</div>
          </div>

          <div class="grid-2">
            <div class="field">
              <label>Comisión aplicada (%)</label>
              <input id="commission" class="readonly" type="text" readonly>
            </div>
            <div class="field">
              <label>Crédito máximo disponible (€)</label>
              <input id="creditCap" class="readonly" type="text" readonly>
            </div>
          </div>

          <div class="field">
            <label>Importe solicitado (€)</label>
            <input id="amount" type="number" min="2000" max="15000" step="100" required>
            <div class="hint">El crédito máximo depende de tus ventas, con un tope de 15.000 €.</div>
          </div>

          <div class="grid-2">
            <div class="field">
              <label>Fee único del crédito (%)</label>
              <input id="fee" type="number" value="10" min="6" max="12" step="0.1">
            </div>
            <div class="field">
              <label>% devolución sobre ventas</label>
              <input id="takeRate" type="number" value="15" min="5" max="30" step="1">
            </div>
          </div>

          <button type="submit" class="cta">Calcular</button>
          <p class="hint">⚠️ Los créditos Booh Finance tienen un plazo máximo de 6 meses.</p>
        </form>

        <div class="simu-result" id="simuResult">
          <div class="cards">
            <div class="card"><h4>Total a devolver</h4><p id="outTotal">—</p></div>
            <div class="card"><h4>Pago mensual estimado</h4><p id="outMonthly">—</p></div>
            <div class="card"><h4>Duración estimada</h4><p id="outDuration">—</p></div>
            <div class="card"><h4>Coste total (fee)</h4><p id="outCost">—</p></div>
          </div>
          <div class="schedule" id="schedule"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- ===== SCRIPT DEL SIMULADOR ===== -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("simuForm");
    const monthlyEl = document.getElementById("monthlySales");
    const commissionEl = document.getElementById("commission");
    const capEl = document.getElementById("creditCap");
    const amountEl = document.getElementById("amount");
    const feeEl = document.getElementById("fee");
    const takeEl = document.getElementById("takeRate");
    const outTotal = document.getElementById("outTotal");
    const outMonthly = document.getElementById("outMonthly");
    const outDur = document.getElementById("outDuration");
    const outCost = document.getElementById("outCost");
    const scheduleEl = document.getElementById("schedule");

    const euro = n => (n || 0).toLocaleString("es-ES", { style: "currency", currency: "EUR" });

    function policyFromSales(sales) {
      if (sales < 5000) return { commission: 12, credit: 2000 };
      if (sales < 8000) return { commission: 10, credit: 5000 };
      if (sales < 12000) return { commission: 8, credit: 8000 };
      if (sales < 16000) return { commission: 7, credit: 12000 };
      return { commission: 6, credit: 15000 };
    }

    function updateProfile() {
      const sales = +monthlyEl.value || 0;
      const { commission, credit } = policyFromSales(sales);
      commissionEl.value = commission.toFixed(1) + " %";
      capEl.value = credit.toLocaleString("es-ES") + " €";

      const requested = +amountEl.value || 0;
      if (!amountEl.dataset.touched || requested > credit || requested < 2000) {
        amountEl.value = credit;
      }
    }

    amountEl.addEventListener("input", () => (amountEl.dataset.touched = "1"));
    monthlyEl.addEventListener("input", updateProfile);

    function calcRBF() {
      const A = +amountEl.value || 0;
      const fee = (+feeEl.value || 0) / 100;
      const sales = +monthlyEl.value || 0;
      const take = (+takeEl.value || 0) / 100;
      const capM = 6;

      const target = A * (1 + fee);
      const monthlyPay = sales * take;

      let remaining = target;
      let month = 0;
      const rows = [];

      while (remaining > 0 && month < capM) {
        month++;
        const pay = Math.min(monthlyPay, remaining);
        const before = remaining;
        remaining -= pay;
        rows.push([month, euro(before), euro(pay), euro(Math.max(remaining, 0))]);
      }

      outTotal.textContent = euro(target);
      outMonthly.textContent = euro(monthlyPay) + " (estimado)";
      outDur.textContent = month + " meses";
      outCost.textContent = euro(target - A);

      renderTable(["Mes", "Pendiente", "Pago", "Restante"], rows);

      if (remaining > 0) {
        const aviso = document.createElement("div");
        aviso.style = "margin-top:10px;color:#ffb347;font-weight:500;text-align:center;";
        aviso.textContent = "⚠️ Plazo máximo 6 meses. El crédito vence al finalizar este periodo.";
        scheduleEl.appendChild(aviso);
      }
    }

    function renderTable(headers, rows) {
      const thead = "<thead><tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr></thead>";
      const tbody = "<tbody>" + rows.map(r => "<tr>" + r.map(c => `<td>${c}</td>`).join("") + "</tr>").join("") + "</tbody>";
      scheduleEl.innerHTML = `<table>${thead}${tbody}</table>`;
    }

    form.addEventListener("submit", e => {
      e.preventDefault();
      calcRBF();
    });

    updateProfile();
  });
  </script>
</body>
</html>